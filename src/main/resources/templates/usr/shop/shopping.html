<th:block th:replace="usr/common/head"/>
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping</title>
    <style>
        html{
            background-color: #FFFEF0;
        }
        /*임시*/
        #Calendar {

        }
        /* 이미지 크기를 150px로 설정 */
        .product-image {
            width: auto; /* 너비는 자동으로 비율에 맞게 조정 */
            height: 150px; /* 높이를 150px로 설정 */
        }

        /* 결과 리스트 스타일 */
        #resultContainer {
            list-style-type: none; /* 기본 리스트 스타일 제거 */
            padding: 0; /* 패딩 제거 */
            border: 1px solid #ccc; /* 전체 리스트에 테두리 추가 */
            border-radius: 5px; /* 네모박스에 모서리 둥글게 */
            overflow: hidden; /* 내부 내용이 넘치지 않게 설정 */
            background-color: #F2F2EB;
        }

        /* 리스트 항목 스타일 */
        .product-item {
            padding: 10px; /* 내부 여백 설정 */
            border-bottom: 1px solid #ccc; /* 항목 사이에 선 추가 */
            display: flex; /* Flexbox 사용 */
            align-items: center; /* 세로 중앙 정렬 */
        }

        /* 마지막 항목에서 하단 선 제거 */
        .product-item:last-child {
            border-bottom: none; /* 마지막 항목의 하단 선 제거 */
        }

        /* 제목과 가격을 포함하는 컨테이너 스타일 */
        .product-info {
            margin-left: 10px; /* 이미지와의 간격 설정 */
        }

        /* 링크 스타일 */
        .product-info a {
            text-decoration: none; /* 밑줄 제거 */
            color: black; /* 텍스트 색상 (검정색) */
        }

        /* 가격 스타일 */
        .product-price {
            font-size: 1.5em; /* 글자 크기를 H3 정도로 설정 (약 1.5em) */
            margin: 0; /* 기본 마진 제거 */
        }

        /* 페이지네이션 스타일 */
        .pagination {
            margin-top: 20px; /* 페이지네이션과 상품 리스트 간격 */
            display: flex;
            justify-content: center; /* 중앙 정렬 */
        }

        .page-item {
            margin: 0 5px; /* 페이지 아이템 간격 */
            cursor: pointer; /* 커서 포인터 */
            padding: 5px 10px; /* 여백 설정 */
            border: 1px solid #ccc; /* 테두리 */
            border-radius: 5px; /* 모서리 둥글게 */
        }
        button {
            background: none; /* 버튼 배경 제거 */
            border: none; /* 버튼 테두리 제거 */
            cursor: pointer; /* 커서 포인터 */
            padding: 5px 10px; /* 여백 설정 */
        }
        #sortButtons {
            display: flex;
            justify-content: flex-end; /* 버튼들을 오른쪽에 배치 */
        }
    </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<div id="Calendar"></div>
<div id="List"></div>
<div id="recommend">
    <!-- 버튼 추가 -->
    <div id="sortButtons">
    <button id="sortByAccuracy">정확도순</button>
    <button id="sortByPrice">최저가순</button>
    </div>

    <!-- 검색 결과를 표시할 곳 -->
    <ul id="resultContainer"></ul> <!-- ul로 변경 -->

    <!-- 페이지네이션 표시 -->
    <div class="pagination" id="paginationContainer">
        <button id="prevPage" class="page-item">이전</button>
        <span id="pageInfo"></span>
        <button id="nextPage" class="page-item">다음</button>
    </div>

    <script>
        let products = []; // 전역 변수로 상품 배열을 선언
        let currentPage = 1; // 현재 페이지
        const itemsPerPage = 5; // 페이지당 아이템 수

        // 페이지 로드 시 자동으로 검색
        document.addEventListener("DOMContentLoaded", function() {
            const query = "%ED%8E%AB%20%EC%9A%A9%ED%92%88";  // 예: "펫 용품"
            searchProducts(query); // 초기 검색 실행
        });

        // 제품 검색 함수
        function searchProducts(query, sort = '') {
            // API 요청 보내기
            fetch('/searchProducts?query=' + query + '&display=' + 100 + sort)
                .then(response => response.json())
                .then(data => {
                    products = data.items; // 전체 상품 데이터를 저장
                    displayResults(products); // 결과 표시
                    setupPagination(products.length); // 페이지네이션 설정
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // 결과를 HTML에 표시하는 함수
        function displayResults(data) {
            const resultContainer = document.getElementById("resultContainer");
            resultContainer.innerHTML = '';  // 기존 내용 초기화

            // 페이지에 따라 데이터 필터링
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = data.slice(startIndex, endIndex);

            // 각 상품을 화면에 표시
            paginatedData.forEach(item => {
                const productItem = document.createElement('li'); // li 요소 생성
                productItem.classList.add('product-item'); // 클래스 추가
                productItem.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" class="product-image">
                    <div class="product-info">
                        <a href="${item.link}">${item.title}</a>
                        <br>
                        <a href="${item.link}" class="product-price">Price: ${item.lprice}원</a>
                    </div>
                `;
                resultContainer.appendChild(productItem);
            });

            // 페이지 정보 업데이트
            document.getElementById("pageInfo").textContent = `${currentPage} / ${Math.ceil(data.length / itemsPerPage)}`;
        }

        // 페이지네이션 설정 함수
        function setupPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage); // 총 페이지 수 계산

            // 이전/다음 버튼 비활성화 처리
            document.getElementById("prevPage").disabled = currentPage === 1;
            document.getElementById("nextPage").disabled = currentPage === totalPages || totalPages === 0;
        }

        // 이전 페이지로 이동
        document.getElementById("prevPage").addEventListener("click", function() {
            if (currentPage > 1) {
                currentPage--; // 현재 페이지 감소
                displayResults(products); // 결과 다시 표시
                setupPagination(products.length); // 페이지네이션 설정
            }
        });

        // 다음 페이지로 이동
        document.getElementById("nextPage").addEventListener("click", function() {
            const totalPages = Math.ceil(products.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++; // 현재 페이지 증가
                displayResults(products); // 결과 다시 표시
                setupPagination(products.length); // 페이지네이션 설정
            }
        });

        // 버튼 클릭 시 최저가 정렬 기능
        document.getElementById("sortByPrice").addEventListener("click", function() {
            // 가격 기준으로 정렬 (최저가 순)
            const sortedProducts = products.sort((a, b) => a.lprice - b.lprice);
            displayResults(sortedProducts); // 정렬된 결과 표시
            setupPagination(sortedProducts.length); // 페이지네이션 설정
        });

        // 버튼 클릭 시 정확도 정렬 기능
        document.getElementById("sortByAccuracy").addEventListener("click", function() {
            const query = "%ED%8E%AB%20%EC%9A%A9%ED%92%88"; // 기존 검색어 사용
            searchProducts(query, '&sort=sim'); // 정확도 기준으로 재요청
        });
    </script>
</div>
</body>
</html>